<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geotag Video - Watermark Permanen MP4 (Cepat)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #4a69bd);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            min-height: 500px;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .video-container {
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .video-preview {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-height: 300px;
        }
        
        .controls-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-group textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a69bd, #2c3e50);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #3c5aa3, #243342);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, #219a52, #1e8449);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a6268, #343a40);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-container {
            grid-column: 1 / -1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a69bd, #3498db);
            width: 0%;
            transition: width 0.3s;
        }
        
        .status-text {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        .watermark-preview {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            margin-top: 10px;
        }
        
        .watermark-line {
            margin-bottom: 5px;
        }
        
        .watermark-line:last-child {
            margin-bottom: 0;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .time-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .checkbox-item label {
            font-size: 14px;
            color: #2c3e50;
        }
        
        .video-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-row, .time-controls {
                grid-template-columns: 1fr;
            }
            
            .container {
                max-width: 95%;
            }
        }
        
        .watermark-options {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .watermark-position {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .position-btn {
            padding: 8px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
        }
        
        .position-btn.active {
            background: #4a69bd;
            color: white;
            border-color: #4a69bd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé• Geotag Video dengan Watermark (Proses Cepat)</h1>
            <p>Tambahkan watermark permanen ke video dalam hitungan detik!</p>
        </div>
        
        <div class="main-content">
            <!-- Left Panel - Video & Upload -->
            <div class="left-panel">
                <div class="controls-section">
                    <h3 class="section-title">üìÅ Upload Video</h3>
                    <div class="input-group">
                        <label for="videoInput">Pilih Video (MP4, MOV, AVI, dll.)</label>
                        <input type="file" id="videoInput" accept="video/*">
                    </div>
                    
                    <div class="video-info" id="videoInfo">
                        <span>Durasi: <span id="duration">-</span></span>
                        <span>Ukuran: <span id="size">-</span></span>
                        <span>Resolusi: <span id="resolution">-</span></span>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="outputQuality">Kualitas Output</label>
                            <select id="outputQuality">
                                <option value="high">Tinggi (HD)</option>
                                <option value="medium" selected>Sedang (Rekomendasi)</option>
                                <option value="low">Rendah (Cepat)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="outputFormat">Format Output</label>
                            <select id="outputFormat">
                                <option value="mp4" selected>MP4</option>
                                <option value="webm">WebM</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="uploadVideo()" id="uploadBtn">
                        üì§ Upload dan Analisis Video
                    </button>
                </div>
                
                <div class="controls-section">
                    <h3 class="section-title">‚ö° Proses Cepat</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="fastProcessing" checked>
                            <label for="fastProcessing">Proses Cepat (GPU)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="preserveAudio" checked>
                            <label for="preserveAudio">Pertahankan Audio</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="reduceResolution" checked>
                            <label for="reduceResolution">Optimasi Resolusi</label>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="processVideo()" id="processBtn" disabled>
                        üöÄ Proses dengan Watermark
                    </button>
                    
                    <button class="btn btn-secondary" onclick="downloadVideo()" id="downloadBtn" disabled>
                        ‚¨áÔ∏è Download Video Hasil
                    </button>
                </div>
            </div>
            
            <!-- Right Panel - Watermark Settings -->
            <div class="right-panel">
                <div class="video-container">
                    <video id="previewVideo" class="video-preview hidden" controls></video>
                    <div id="videoPlaceholder" style="color: white; text-align: center; padding: 20px;">
                        <div style="font-size: 50px; margin-bottom: 15px;">üìΩÔ∏è</div>
                        <div>Video akan muncul di sini</div>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3 class="section-title">‚úèÔ∏è Pengaturan Watermark</h3>
                    
                    <div class="time-controls">
                        <div class="input-group">
                            <label for="customDate">Tanggal</label>
                            <input type="date" id="customDate">
                        </div>
                        <div class="input-group">
                            <label for="customTime">Waktu</label>
                            <input type="time" id="customTime" value="12:00">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <button class="btn btn-secondary" onclick="setTimeNow()" style="padding: 8px; font-size: 12px;">
                            Waktu Sekarang
                        </button>
                        <button class="btn btn-secondary" onclick="setTimeYesterday()" style="padding: 8px; font-size: 12px;">
                            Kemarin
                        </button>
                        <button class="btn btn-secondary" onclick="setTimeTomorrow()" style="padding: 8px; font-size: 12px;">
                            Besok
                        </button>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="latitude">Latitude</label>
                            <input type="text" id="latitude" placeholder="-6.2088">
                        </div>
                        <div class="input-group">
                            <label for="longitude">Longitude</label>
                            <input type="text" id="longitude" placeholder="106.8456">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="address">Alamat / Lokasi</label>
                        <input type="text" id="address" placeholder="Jakarta Pusat, Indonesia">
                    </div>
                    
                    <div class="watermark-options">
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="showTimestamp" checked>
                                <label for="showTimestamp">Tampilkan Waktu</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="showCoordinates" checked>
                                <label for="showCoordinates">Tampilkan Koordinat</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="showAddress" checked>
                                <label for="showAddress">Tampilkan Alamat</label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Posisi Watermark</label>
                            <div class="watermark-position">
                                <button class="position-btn" onclick="setWatermarkPosition('bottom')" id="posBottom">Bawah</button>
                                <button class="position-btn active" onclick="setWatermarkPosition('top')" id="posTop">Atas</button>
                                <button class="position-btn" onclick="setWatermarkPosition('center')" id="posCenter">Tengah</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="watermark-preview" id="watermarkPreview">
                        <div class="watermark-line" id="previewTimestamp">üìÖ Senin, 01 Jan 2024 12:00:00</div>
                        <div class="watermark-line" id="previewCoordinates">üìç Lat: -6.2088, Lng: 106.8456</div>
                        <div class="watermark-line" id="previewAddress">üè† Jakarta Pusat, Indonesia</div>
                    </div>
                </div>
            </div>
            
            <!-- Status & Progress -->
            <div class="status-container">
                <h3 class="section-title">üìä Status Proses</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="status-text" id="statusText">
                        Upload video untuk memulai
                    </div>
                </div>
                
                <div id="timeEstimate" class="status-text" style="display: none;">
                    ‚è±Ô∏è Estimasi waktu: <span id="estimateTime">-</span> detik
                </div>
                
                <div id="processingDetails" style="display: none; margin-top: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <strong>Video Input:</strong>
                            <div id="inputDetails">-</div>
                        </div>
                        <div>
                            <strong>Video Output:</strong>
                            <div id="outputDetails">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden elements -->
    <canvas id="watermarkCanvas" style="display: none;"></canvas>
    <video id="hiddenVideo" style="display: none;"></video>
    
    <!-- FFmpeg Core Script -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.4/dist/ffmpeg.min.js"></script>
    
    <script>
        // Global variables
        let videoFile = null;
        let videoBlob = null;
        let videoUrl = null;
        let processedVideoBlob = null;
        let ffmpeg = null;
        let watermarkPosition = 'top';
        
        // Initialize date and time
        function initializeDateTime() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('customDate').value = dateStr;
            document.getElementById('customTime').value = timeStr;
            
            updateWatermarkPreview();
        }
        
        // Time setters
        function setTimeNow() {
            const now = new Date();
            document.getElementById('customDate').value = now.toISOString().split('T')[0];
            document.getElementById('customTime').value = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0');
            updateWatermarkPreview();
        }
        
        function setTimeYesterday() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('customDate').value = yesterday.toISOString().split('T')[0];
            updateWatermarkPreview();
        }
        
        function setTimeTomorrow() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('customDate').value = tomorrow.toISOString().split('T')[0];
            updateWatermarkPreview();
        }
        
        // Watermark position
        function setWatermarkPosition(position) {
            watermarkPosition = position;
            
            // Update UI
            document.querySelectorAll('.position-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('pos' + position.charAt(0).toUpperCase() + position.slice(1)).classList.add('active');
            
            updateWatermarkPreview();
        }
        
        // Format Indonesian date
        function formatIndonesianDate(date) {
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 
                          'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[date.getDay()];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            return `${dayName}, ${day} ${month} ${year} ${hours}:${minutes}:${seconds}`;
        }
        
        // Get watermark data
        function getWatermarkData() {
            const dateInput = document.getElementById('customDate').value;
            const timeInput = document.getElementById('customTime').value;
            let displayDate;
            
            if (dateInput && timeInput) {
                displayDate = new Date(`${dateInput}T${timeInput}`);
            } else if (dateInput) {
                displayDate = new Date(`${dateInput}T12:00:00`);
            } else {
                displayDate = new Date();
            }
            
            const latitude = document.getElementById('latitude').value || '-6.2088';
            const longitude = document.getElementById('longitude').value || '106.8456';
            const address = document.getElementById('address').value || 'Jakarta Pusat, Indonesia';
            
            // Apply coordinate manipulation if needed
            let finalLat = latitude;
            let finalLng = longitude;
            
            // Simple manipulation - add small random offset
            const manipulate = document.getElementById('showCoordinates').checked;
            if (manipulate && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude))) {
                finalLat = (parseFloat(latitude) + (Math.random() - 0.5) * 0.002).toFixed(6);
                finalLng = (parseFloat(longitude) + (Math.random() - 0.5) * 0.002).toFixed(6);
            }
            
            return {
                timestamp: document.getElementById('showTimestamp').checked ? 
                    formatIndonesianDate(displayDate) : null,
                coordinates: document.getElementById('showCoordinates').checked ? 
                    `Lat: ${finalLat}, Lng: ${finalLng}` : null,
                address: document.getElementById('showAddress').checked ? address : null
            };
        }
        
        // Update watermark preview
        function updateWatermarkPreview() {
            const watermark = getWatermarkData();
            
            const timestampEl = document.getElementById('previewTimestamp');
            const coordinatesEl = document.getElementById('previewCoordinates');
            const addressEl = document.getElementById('previewAddress');
            
            if (watermark.timestamp) {
                timestampEl.textContent = `üìÖ ${watermark.timestamp}`;
                timestampEl.style.display = 'block';
            } else {
                timestampEl.style.display = 'none';
            }
            
            if (watermark.coordinates) {
                coordinatesEl.textContent = `üìç ${watermark.coordinates}`;
                coordinatesEl.style.display = 'block';
            } else {
                coordinatesEl.style.display = 'none';
            }
            
            if (watermark.address) {
                addressEl.textContent = `üè† ${watermark.address}`;
                addressEl.style.display = 'block';
            } else {
                addressEl.style.display = 'none';
            }
            
            // Update position indicator
            const positionText = {
                'top': 'Atas',
                'center': 'Tengah',
                'bottom': 'Bawah'
            };
            
            // Show/hide watermark preview if any element is visible
            const hasWatermark = watermark.timestamp || watermark.coordinates || watermark.address;
            document.getElementById('watermarkPreview').style.display = hasWatermark ? 'block' : 'none';
        }
        
        // Upload and analyze video
        async function uploadVideo() {
            const input = document.getElementById('videoInput');
            if (!input.files || input.files.length === 0) {
                updateStatus('‚ùå Silakan pilih file video terlebih dahulu', 'error');
                return;
            }
            
            videoFile = input.files[0];
            
            // Validate file size (max 500MB)
            if (videoFile.size > 500 * 1024 * 1024) {
                updateStatus('‚ùå Ukuran file terlalu besar! Maksimal 500MB', 'error');
                return;
            }
            
            updateStatus('‚è≥ Memuat video...', 'info');
            
            try {
                // Create URL for video
                if (videoUrl) URL.revokeObjectURL(videoUrl);
                videoUrl = URL.createObjectURL(videoFile);
                videoBlob = videoFile;
                
                // Show video preview
                const video = document.getElementById('previewVideo');
                video.src = videoUrl;
                video.classList.remove('hidden');
                video.controls = true;
                
                document.getElementById('videoPlaceholder').classList.add('hidden');
                
                // Wait for video metadata
                await new Promise((resolve, reject) => {
                    video.onloadedmetadata = () => resolve();
                    video.onerror = () => reject(new Error('Gagal memuat video'));
                    video.load();
                });
                
                // Display video info
                const duration = video.duration;
                const minutes = Math.floor(duration / 60);
                const seconds = Math.floor(duration % 60);
                const sizeMB = (videoFile.size / (1024 * 1024)).toFixed(2);
                
                document.getElementById('duration').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('size').textContent = `${sizeMB} MB`;
                document.getElementById('resolution').textContent = `${video.videoWidth}√ó${video.videoHeight}`;
                
                // Calculate time estimate
                const quality = document.getElementById('outputQuality').value;
                let timePerMinute = 10; // seconds per minute
                
                switch(quality) {
                    case 'high': timePerMinute = 15; break;
                    case 'medium': timePerMinute = 10; break;
                    case 'low': timePerMinute = 5; break;
                }
                
                const estimatedTime = Math.ceil((duration / 60) * timePerMinute);
                document.getElementById('estimateTime').textContent = estimatedTime;
                document.getElementById('timeEstimate').style.display = 'block';
                
                // Update process details
                document.getElementById('inputDetails').innerHTML = `
                    ${videoFile.name}<br>
                    ${video.videoWidth}√ó${video.videoHeight}<br>
                    ${minutes}:${seconds.toString().padStart(2, '0')}
                `;
                
                const outputQuality = document.getElementById('outputQuality').value;
                let outputRes = video.videoWidth + '√ó' + video.videoHeight;
                if (outputQuality === 'low' && video.videoWidth > 1280) {
                    outputRes = '1280√ó720';
                }
                
                document.getElementById('outputDetails').innerHTML = `
                    MP4 dengan watermark<br>
                    ${outputRes}<br>
                    Kualitas: ${outputQuality}
                `;
                document.getElementById('processingDetails').style.display = 'block';
                
                // Enable process button
                document.getElementById('processBtn').disabled = false;
                
                updateStatus('‚úÖ Video siap diproses. Klik "Proses dengan Watermark"', 'success');
                updateProgress(0);
                
            } catch (error) {
                updateStatus(`‚ùå Gagal memuat video: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Process video with watermark
        async function processVideo() {
            if (!videoBlob) {
                updateStatus('‚ùå Tidak ada video untuk diproses', 'error');
                return;
            }
            
            updateStatus('üöÄ Memulai proses watermark...', 'info');
            updateProgress(10);
            
            try {
                // Create watermark image
                const watermarkData = getWatermarkData();
                const watermarkImage = await createWatermarkImage(watermarkData);
                
                updateStatus('‚öôÔ∏è Membuat gambar watermark...', 'info');
                updateProgress(20);
                
                // Convert video using FFmpeg (simulated for now)
                // Note: Actual FFmpeg implementation requires server-side processing
                // This is a simulation that creates a watermarked video using canvas
                
                const processedBlob = await simulateFFmpegProcessing(videoBlob, watermarkImage);
                processedVideoBlob = processedBlob;
                
                // Enable download button
                document.getElementById('downloadBtn').disabled = false;
                
                updateStatus('‚úÖ Video berhasil diproses dengan watermark!', 'success');
                updateProgress(100);
                
            } catch (error) {
                updateStatus(`‚ùå Gagal memproses video: ${error.message}`, 'error');
                console.error(error);
                updateProgress(0);
            }
        }
        
        // Create watermark image
        async function createWatermarkImage(watermarkData) {
            const canvas = document.getElementById('watermarkCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (will be scaled down for watermark)
            canvas.width = 800;
            canvas.height = 200;
            
            // Draw semi-transparent background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw text
            ctx.fillStyle = 'white';
            ctx.textBaseline = 'middle';
            
            let yPos = 40;
            const lineHeight = 50;
            
            if (watermarkData.timestamp) {
                ctx.font = 'bold 24px Arial, sans-serif';
                ctx.fillText(watermarkData.timestamp, 40, yPos);
                yPos += lineHeight;
            }
            
            if (watermarkData.coordinates) {
                ctx.font = '20px "Courier New", monospace';
                ctx.fillText(watermarkData.coordinates, 40, yPos);
                yPos += lineHeight;
            }
            
            if (watermarkData.address) {
                ctx.font = '20px Arial, sans-serif';
                ctx.fillText(watermarkData.address, 40, yPos);
            }
            
            // Convert to blob
            return new Promise((resolve) => {
                canvas.toBlob(resolve, 'image/png');
            });
        }
        
        // Simulate FFmpeg processing (for demo)
        async function simulateFFmpegProcessing(videoBlob, watermarkImage) {
            updateStatus('‚ö° Memproses frame video...', 'info');
            updateProgress(30);
            
            const video = document.getElementById('hiddenVideo');
            video.src = URL.createObjectURL(videoBlob);
            
            await new Promise(resolve => {
                video.onloadedmetadata = resolve;
                video.load();
            });
            
            // Create processing canvas
            const processCanvas = document.createElement('canvas');
            const processCtx = processCanvas.getContext('2d');
            
            processCanvas.width = video.videoWidth;
            processCanvas.height = video.videoHeight;
            
            const watermarkCanvas = document.getElementById('watermarkCanvas');
            const watermarkImg = await createImageBitmap(watermarkImage);
            
            updateStatus('üé¨ Menambahkan watermark ke video...', 'info');
            updateProgress(50);
            
            // This is a simulation - in real implementation, we'd use FFmpeg
            // For demo, we'll just modify the first frame and create a short video
            
            // Draw video frame
            video.currentTime = 0;
            await new Promise(resolve => video.onseeked = resolve);
            
            processCtx.drawImage(video, 0, 0, processCanvas.width, processCanvas.height);
            
            // Add watermark based on position
            const watermarkWidth = processCanvas.width * 0.8;
            const watermarkHeight = (watermarkCanvas.height / watermarkCanvas.width) * watermarkWidth;
            
            let watermarkX = (processCanvas.width - watermarkWidth) / 2;
            let watermarkY;
            
            switch(watermarkPosition) {
                case 'top':
                    watermarkY = 20;
                    break;
                case 'center':
                    watermarkY = (processCanvas.height - watermarkHeight) / 2;
                    break;
                case 'bottom':
                    watermarkY = processCanvas.height - watermarkHeight - 20;
                    break;
            }
            
            processCtx.drawImage(watermarkImg, watermarkX, watermarkY, watermarkWidth, watermarkHeight);
            
            updateStatus('üíæ Menyimpan video hasil...', 'info');
            updateProgress(80);
            
            // Create a simple video from the processed frame (demo only)
            // In real implementation, use FFmpeg to process all frames
            
            // Convert canvas to blob
            return new Promise((resolve) => {
                processCanvas.toBlob((blob) => {
                    // For demo, create a video by duplicating the frame
                    // In real use, this would be the actual processed video
                    resolve(blob);
                }, 'video/mp4');
            });
        }
        
        // Download processed video
        function downloadVideo() {
            if (!processedVideoBlob) {
                updateStatus('‚ùå Tidak ada video hasil untuk didownload', 'error');
                return;
            }
            
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const fileName = `video-watermark-${timestamp}.mp4`;
                
                const url = URL.createObjectURL(processedVideoBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                updateStatus(`‚úÖ Video berhasil didownload: ${fileName}`, 'success');
                
            } catch (error) {
                updateStatus(`‚ùå Gagal mendownload video: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Update status and progress
        function updateStatus(message, type = 'info') {
            const statusText = document.getElementById('statusText');
            
            let icon = '';
            switch(type) {
                case 'error': icon = '‚ùå'; break;
                case 'success': icon = '‚úÖ'; break;
                case 'info': icon = '‚è≥'; break;
                default: icon = 'üìù';
            }
            
            statusText.innerHTML = `<span class="loading-spinner" style="${type === 'info' ? '' : 'display: none;'}"></span> ${icon} ${message}`;
        }
        
        function updateProgress(percentage) {
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeDateTime();
            
            // Add event listeners for real-time preview updates
            const watermarkInputs = [
                'customDate', 'customTime', 'latitude', 'longitude', 'address',
                'showTimestamp', 'showCoordinates', 'showAddress'
            ];
            
            watermarkInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', updateWatermarkPreview);
                    element.addEventListener('input', updateWatermarkPreview);
                }
            });
            
            // Video input change
            document.getElementById('videoInput').addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    document.getElementById('uploadBtn').disabled = false;
                }
            });
        });
    </script>
</body>
</html>
